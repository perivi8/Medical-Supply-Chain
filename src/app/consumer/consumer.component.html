<!-- Page Container -->
<div class="form-background d-flex justify-content-center align-items-start py-5 min-vh-100">
  <div class="container bg-white bg-opacity-75 rounded shadow-lg p-4" style="max-width: 700px;">

    <!-- Title -->
    <h2 class="text-center mb-4 animate__animated animate__fadeInDown fw-bold text-primary">
      Consumer - Medicine Journey
    </h2>

    <!-- QR Code Scanner Section -->
    <div class="mb-4">
      <h5 class="fw-semibold mb-2">Scan QR Code</h5>
      <button
        (click)="toggleScanner()"
        class="btn btn-outline-primary w-100 mb-2"
        [disabled]="!hasCamera">
        {{ isScanning ? 'Stop Scanning' : 'Start Scanning' }}
      </button>

      <div *ngIf="isScanning" class="border rounded overflow-hidden">
        <zxing-scanner
          [device]="currentDevice"
          [formats]="formatsEnabled"
          (scanSuccess)="onScanSuccess($event)"
          (scanError)="onScanError($event)"
          class="w-100">
        </zxing-scanner>
      </div>
    </div>

    <!-- Manual ID Entry Form -->
    <form (ngSubmit)="onSubmit()" class="mb-4">
      <div class="mb-3">
        <label class="form-label fw-semibold">Enter Medicine ID</label>
        <input
          type="text"
          [(ngModel)]="medicineId"
          name="medicineId"
          class="form-control"
          placeholder="Enter Medicine ID"
          required>
      </div>
      <button type="submit" class="btn btn-primary w-100">View History</button>
    </form>

    <!-- Product History Section -->
    <div *ngIf="history" class="timeline">
      <!-- Raw Material -->
      <div class="timeline-item mb-4 p-3 border-start border-3 border-primary bg-light rounded">
        <h5 class="fw-bold text-primary">Raw Material</h5>
        <p>Type: {{ history.raw_material.material_type }}</p>
        <p>Quantity: {{ history.raw_material.quantity }} kg</p>
        <p>Location: {{ history.raw_material.source_location }}</p>
        <p>Date: {{ history.raw_material.supply_date }}</p>
      </div>

      <!-- Manufacturing -->
      <div class="timeline-item mb-4 p-3 border-start border-3 border-success bg-light rounded">
        <h5 class="fw-bold text-success">Manufacturing</h5>
        <p>Name: {{ history.medicine.medicine_name }}</p>
        <p>Batch: {{ history.medicine.batch_number }}</p>
        <p>Production: {{ history.medicine.production_date }}</p>
        <p>Expiry: {{ history.medicine.expiry_date }}</p>
      </div>

      <!-- Distribution -->
      <div *ngFor="let dist of history?.distributions" class="timeline-item mb-4 p-3 border-start border-3 border-warning bg-light rounded">
        <h5 class="fw-bold text-warning">Distribution</h5>
        <p>Shipment: {{ dist.shipment_date }}</p>
        <p>Transport: {{ dist.transport_method }}</p>
        <p>Destination: {{ dist.destination }}</p>
        <p>Storage: {{ dist.storage_condition }}</p>
      </div>

      <!-- Retail Sales -->
      <div *ngFor="let sale of history?.retail_sales" class="timeline-item mb-4 p-3 border-start border-3 border-danger bg-light rounded">
        <h5 class="fw-bold text-danger">Retail</h5>
        <p>Received: {{ sale.received_date }}</p>
        <p>Price: ${{ sale.price }}</p>
        <p>Location: {{ sale.retail_location }}</p>
      </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="text-danger text-center mt-3">{{ error }}</div>

  </div>
</div>

<!-- Footer -->
<app-footer></app-footer>
